version: "3.8"

services:
  sugarcane:
    build:
      context: ./sugarcane
      dockerfile: Dockerfile.sugarcane
    ports:
      - "80:80" 
    volumes:
      - ./sugarcane:/app/sugarcane 
      - ./sugarlib:/app/sugarlib 
      - ./content:/app/content
    command: ["python3", "sugarcane/app.py"]
  demo:
    build:
      context: ./demo_application  # Build the image from the demo_application directory
      dockerfile: Dockerfile.demo
    ports:
      - "8000:8000"
    volumes:
      - ./demo_application:/app  # Mount the local demo directory to the container
    depends_on:
      - sugarcane  # Demo depends on sugarcane to be up before starting
  content:
    image: "mucize-sugarcane"
    volumes:
      - ./sugarlib:/app/sugarlib  # Mount the local demo directory to the container
      - ./content:/app/content
    command: ["python3", "content/faker.py", "loop"]
    depends_on:
      - "redis"
  redis:
    image: "redis:alpine"
    ports:
      - "63791:6379"
